// Auto-generated by branding generator. Do not edit directly.
// Source: tools/branding/templates/docker-bake.hcl.tmpl

target "meta" {
  context    = "."
  dockerfile = "tools/traceability/Dockerfile.meta"
  target     = "out"
  contexts = {
    git_dir    = ".git"
    git_common = ".git"
    trace_tools = "tools/traceability"
  }
  output = ["type=local,dest={{OUTPUT_DIR}}/meta"]
}

target "meta-image" {
  context    = "."
  dockerfile = "tools/traceability/Dockerfile.meta"
  target     = "meta"
  contexts = {
    git_dir    = ".git"
    git_common = ".git"
    trace_tools = "tools/traceability"
  }
  tags     = ["{{SLUG}}-meta:debug"]
  output   = ["type=docker"]
}

// Base/control images (targets are configured at runtime via bake overrides).
target "lambda-base" {
  context    = "cli/internal/generator/assets"
  dockerfile = "Dockerfile.lambda-base"
  contexts = {
    meta = "target:meta"
  }
}

target "os-base" {
  context    = "services/common"
  dockerfile = "Dockerfile.os-base"
  contexts = {
    meta = "target:meta"
  }
  tags = ["{{SLUG}}-os-base:latest"]
  output = ["type=docker"]
  cache-from = ["type=local,src={{OUTPUT_DIR}}/buildx-cache/base"]
  cache-to   = ["type=local,dest={{OUTPUT_DIR}}/buildx-cache/base,mode=max"]
}

target "python-base" {
  context    = "services/common"
  dockerfile = "Dockerfile.python-base"
  contexts = {
    meta = "target:meta"
  }
  tags = ["{{SLUG}}-python-base:latest"]
  output = ["type=docker"]
  cache-from = ["type=local,src={{OUTPUT_DIR}}/buildx-cache/base"]
  cache-to   = ["type=local,dest={{OUTPUT_DIR}}/buildx-cache/base,mode=max"]
}

group "base-images" {
  targets = ["lambda-base", "os-base", "python-base"]
}
